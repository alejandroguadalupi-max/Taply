<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>Taply — Sube la valoración de tu negocio sin esfuerzo</title>
  <meta name="description" content="Sé un imán de clientes con Taply: más y mejores reseñas online con tecnología NFC. Convierte opiniones positivas en reseñas de Google y aprende de las negativas." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f1a; --bg-2:#0e1424; --txt:#e9eefc; --muted:#94a3b8;
      --brand-1:#00d4ff; --brand-2:#7c3aed; --ok:#22c55e; --warn:#f59e0b;
      --radius:20px; --shadow:0 10px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
      --arrowSize:56px; --edgePad:calc(var(--arrowSize) + 28px);
    }
    *{box-sizing:border-box}
    html{-webkit-text-size-adjust:100%}
    html,body{margin:0;height:100%;scroll-behavior:smooth}
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg); color:var(--txt);
      opacity:0; transform:translateY(4px);
      transition:opacity .35s ease, transform .35s ease;
    }
    body.is-loaded{opacity:1;transform:none}
    a{color:inherit;text-decoration:none}
    .container{width:min(1200px,92%);margin-inline:auto}
    body::before{content:"";position:fixed;inset:0;z-index:-1;pointer-events:none;background-image:radial-gradient(rgba(255,255,255,.08) 1px, transparent 1.6px);background-size:26px 26px;opacity:.12}

    header{position:sticky;top:0;z-index:60;background:#0a0f16cc;border-bottom:1px solid rgba(255,255,255,.06);backdrop-filter:blur(10px)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0; position:relative}
    .brand{display:flex;gap:10px;align-items:center;font-weight:800;letter-spacing:.3px}
    .brand-logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--brand-1),var(--brand-2));display:grid;place-items:center;box-shadow:0 8px 22px rgba(124,58,237,.35)}
    .brand-logo svg{width:20px;height:20px}
    .nav-links{display:flex;gap:18px;align-items:center}
    .ghost{padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.12);color:var(--txt);touch-action:manipulation}
    .menu{display:none}

    /* Cuenta (avatar + dropdown) */
    .acct-chip{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border:1px solid rgba(255,255,255,.14);border-radius:999px;background:rgba(255,255,255,.04);cursor:pointer}
    .acct-avatar{width:28px;height:28px;border-radius:999px;background:linear-gradient(135deg,var(--brand-1),var(--brand-2));display:grid;place-items:center;font-weight:800;color:#061017}
    .acct-dd{position:relative}
    .acct-menu{position:absolute;right:0;top:110%;min-width:220px;background:#0b0f1a;border:1px solid rgba(255,255,255,.12);border-radius:14px;box-shadow:var(--shadow);display:none;padding:6px}
    .acct-menu a,.acct-menu button{display:flex;width:100%;text-align:left;background:transparent;border:0;color:inherit;padding:10px 12px;border-radius:10px;cursor:pointer}
    .acct-menu a:hover,.acct-menu button:hover{background:rgba(255,255,255,.06)}
    .acct-dd.open .acct-menu{display:block}

    .mobile-menu{position:absolute; left:0; right:0; top:100%; display:none; padding:14px; background:#0b0f1a; border-top:1px solid rgba(255,255,255,.08); box-shadow:0 16px 40px rgba(0,0,0,.45)}
    .mobile-links{display:flex;flex-direction:column;gap:10px}
    .mobile-links .ghost{background:rgba(255,255,255,.02); border-color:rgba(255,255,255,.18)}
    .mobile-links .btn{width:100%; justify-content:center}

    .btn{
      --p:14px 18px; background:linear-gradient(135deg,var(--brand-1),var(--brand-2));
      color:#061017;font-weight:700;border:0;border-radius:999px;cursor:pointer;touch-action:manipulation;
      padding:var(--p);display:inline-flex;align-items:center;gap:8px;
      box-shadow:0 10px 30px rgba(124,58,237,.35), 0 4px 14px rgba(0,212,255,.25);
      position:relative; overflow:hidden; transform:translateZ(0);
      transition:transform .15s ease, box-shadow .2s ease, filter .2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ transform:translateY(-2px) }
    .btn:active{ transform:translateY(0); filter:saturate(1.1) }
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.12);color:var(--txt);box-shadow:none}

    .hero{padding:64px 0 40px; text-align:center}
    .hero-grid{display:grid;grid-template-columns:1fr;gap:18px;justify-items:center}
    h1,h2,h3,p{ text-align:center }
    h1{font-size:clamp(2rem,4.5vw,3.2rem);line-height:1.1;margin:10px 0 6px}
    .lead{color:var(--muted);font-size:1.05rem;max-width:900px;margin:0 auto}
    .cta-row{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-top:18px}
    .pills{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);padding:10px 14px;border-radius:999px}

    section{padding:56px 0}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:var(--bg-2);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);text-align:center}
    .card h3{margin:.2rem 0 .6rem}
    .card p{color:var(--muted);margin:0}

    .reviews{position:relative;margin:36px 0}
    .reviews h2{margin:0 0 14px}
    .reviews-window{position:relative;overflow:hidden}
    .reviews-track{
      display:flex;gap:22px;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;
      padding:0 var(--edgePad);scroll-padding:0 var(--edgePad);scrollbar-width:none;
      overscroll-behavior-x: contain; touch-action: pan-y;
    }
    .review-card{
      flex:0 0 clamp(360px, 40vw, 480px);max-width:520px;
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.1);
      border-radius:16px;padding:20px;scroll-snap-align:center;scroll-snap-stop:normal;
      text-align:left;box-shadow:0 20px 50px rgba(0,0,0,.35);
    }
    .review-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .review-avatar{width:54px;height:54px;border-radius:999px;overflow:hidden;flex:0 0 54px;border:1px solid rgba(255,255,255,.14);box-shadow:0 10px 22px rgba(124,58,237,.25)}
    .review-name{font-weight:700}
    .review-stars{color:#fbbf24;font-size:18px;letter-spacing:2px}
    .review-text{color:#c9d3e6;margin:6px 0 12px}

    .faq{max-width:900px;margin-inline:auto}
    .acc{border:1px solid rgba(255,255,255,.10);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.02);box-shadow:var(--shadow)}
    .acc-item + .acc-item{border-top:1px solid rgba(255,255,255,.08)}
    .acc-btn{width:100%;background:transparent;border:0;color:var(--txt);
      padding:18px 20px;font-size:1rem;font-weight:700;
      display:flex;justify-content:center;align-items:center;gap:10px;text-align:center}
    .acc-panel{max-height:0;overflow:hidden;transition:max-height .3s ease}
    .acc-panel > div{padding:0 20px 18px;color:var(--muted);text-align:center}

    .cookiebar{position:fixed;left:0;right:0;bottom:0;z-index:50;background:#0a0f16;color:#dbeafe;border-top:1px solid rgba(255,255,255,.08);display:flex;align-items:center;gap:14px;justify-content:space-between;padding:12px 16px}
    .cookiebar p{margin:0;font-size:.95rem;text-align:left}
    .cookiebar .btn-accept{background:#6366f1;border:0;color:#fff;border-radius:8px;padding:8px 16px;cursor:pointer}

    input,select,textarea,button{font-size:16px}
    :focus-visible{outline:2px solid #7c3aed; outline-offset:2px; border-radius:8px}

    @media (max-width: 768px){
      :root{ --arrowSize:48px; --edgePad:72px; }
      section{padding:48px 0}
      header{background:#0a0f16}
      .grid-3{grid-template-columns:1fr}
      .nav-links{display:none}
      .menu{
        display:block;background:#0f172a;color:#e9eefc;border:1px solid rgba(255,255,255,.28);
        box-shadow:0 8px 24px rgba(0,0,0,.45);padding:10px 14px;border-radius:999px;touch-action:manipulation;
      }
      .menu:hover{filter:brightness(1.08)}
      .menu:active{transform:translateY(1px)}
      .cookiebar{flex-direction:column;align-items:flex-start;gap:10px}
    }
    @media (prefers-reduced-motion: reduce){ *{animation:none!important;transition:none!important} }

    /* MODAL CUENTA (pro) */
    #acct-modal.acct-hidden{display:none!important}
    #acct-modal{position:fixed;inset:0;background:rgba(6,10,18,.6);backdrop-filter:blur(8px);display:grid;place-items:center;z-index:1000}
    .acct-dialog{width:min(520px,92%);background:var(--bg-2);color:var(--txt);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:var(--shadow);padding:20px}
    .acct-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .acct-x{background:transparent;border:0;color:inherit;font-size:22px;cursor:pointer}
    .acct-tabs{display:flex;gap:8px;margin:10px 0 12px}
    .acct-tab{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700}
    .acct-tab.acct-tab-active{background:linear-gradient(135deg,var(--brand-1),var(--brand-2));color:#061017}
    .acct-form{display:grid;gap:10px}
    .acct-form label{display:grid;gap:6px;font-weight:600}
    .acct-input{position:relative}
    .acct-input input{background:#0a0f16;border:1px solid rgba(255,255,255,.12);color:inherit;border-radius:12px;padding:12px;width:100%}
    .toggle-eye{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:transparent;border:0;color:#cfe3ff;cursor:pointer}
    .acct-msg{color:#cfe3ff;margin:0 0 8px;font-size:.95rem}
    .acct-err{color:#fca5a5}
    .acct-small{color:var(--muted);font-size:.92rem;margin-top:6px}
    .acct-link{color:#b3e1ff;text-decoration:underline;cursor:pointer}
    .pw-meter{height:6px;border-radius:6px;background:#1f2937;overflow:hidden}
    .pw-meter > span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e)}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="index.html" aria-label="Inicio">
        <span class="brand-logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><path d="M5 12a7 7 0 1114 0v6.5a2.5 2.5 0 01-5 0V9.75a2.25 2.25 0 10-4.5 0V18.5a2.5 2.5 0 01-5 0V12z" stroke="#061017" stroke-width="1.7"/></svg>
        </span>
        <span>taply</span>
      </a>

      <nav class="nav-links">
        <a class="ghost" href="#beneficios">Beneficios</a>
        <a class="ghost" href="#como-funciona">Cómo funciona</a>
        <a class="ghost" href="#reviews">Opiniones</a>
        <a class="ghost" href="suscripciones.html">Suscripciones</a>
        <a class="btn" href="suscripciones.html">¡Comenzar ahora!</a>
        <span id="acct-nav-slot" class="acct-dd"></span>
      </nav>

      <button class="menu ghost" id="menuBtn" aria-expanded="false" aria-controls="mobileMenu">Menú</button>
    </div>

    <div class="container mobile-menu" id="mobileMenu" role="menu" aria-label="Menú móvil">
      <div class="mobile-links">
        <a class="ghost" href="#beneficios" role="menuitem">Beneficios</a>
        <a class="ghost" href="#como-funciona" role="menuitem">Cómo funciona</a>
        <a class="ghost" href="#reviews" role="menuitem">Opiniones</a>
        <a class="ghost" href="suscripciones.html" role="menuitem">Suscripciones</a>
        <a class="btn" href="suscripciones.html" role="menuitem">¡Comenzar ahora!</a>
        <span id="acct-nav-slot-mobile" class="acct-dd" style="margin-top:8px"></span>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container hero-grid">
        <div>
          <h1>¿Imaginas subir la valoración de tu negocio <em>SIN HACER NADA</em>?</h1>
          <p class="lead">Aumenta tus reseñas, protege tu reputación y convierte opiniones en más clientes y más ingresos, sin mover un solo dedo.</p>
          <div class="pills"><div class="pill">Mejores reseñas</div><div class="pill">Más clientes</div><div class="pill">Más dinero</div></div>
          <div class="cta-row"><a class="btn" href="suscripciones.html">Ver suscripciones</a></div>
        </div>
      </div>
    </section>

    <section id="beneficios">
      <div class="container">
        <h2>¿Qué podrás conseguir gracias a nuestro sistema?</h2>
        <p class="lead">Taply te asegura conseguir <strong>mejores reseñas</strong>, atraer <strong>más clientes</strong> y generar <strong>más ingresos</strong>.</p>
        <div class="grid-3" style="margin-top:20px">
          <article class="card"><h3>Crea un clima donde la opinión importa</h3><p>El cliente acerca su móvil al NFC y deja su reseña en segundos.</p></article>
          <article class="card"><h3>Encuentra puntos débiles</h3><p>Las negativas no se publican: van a tu panel privado para aprender y mejorar.</p></article>
          <article class="card"><h3>Gana dinero</h3><p>Mejores valoraciones = más visibilidad = más clientes.</p></article>
        </div>
        <div class="cta-row"><a class="btn" href="suscripciones.html">Empezar ahora</a></div>
      </div>
    </section>

    <section class="reviews" id="reviews">
      <div class="container">
        <h2>Valorado 4,8/5 por más de 30 negocios</h2>
        <div class="reviews-window">
          <div class="reviews-track" id="reviewsTrack" tabindex="0" aria-label="Opiniones de clientes">
            <article class="review-card"><div class="review-header"><div class="review-avatar"><img loading="lazy" src="https://i.pravatar.cc/110?img=26" alt="Sara Cordero" width="54" height="54"></div><div><div class="review-name">Sara Cordero</div><div class="review-stars">★★★★★</div></div></div><p class="review-text">Instalación en 5 minutos. Los avisos de reseñas negativas nos han permitido corregir fallos en días.</p></article>
            <article class="review-card"><div class="review-header"><div class="review-avatar"><img loading="lazy" src="https://i.pravatar.cc/110?img=33" alt="Marlon Melara" width="54" height="54"></div><div><div class="review-name">Marlon Melara</div><div class="review-stars">★★★★★</div></div></div><p class="review-text">Ahorra tiempo en reputación online. Muy fácil para el cliente.</p></article>
            <article class="review-card"><div class="review-header"><div class="review-avatar"><img loading="lazy" src="https://i.pravatar.cc/110?img=12" alt="Joan Blanch" width="54" height="54"></div><div><div class="review-name">Joan Blanch</div><div class="review-stars">★★★★★</div></div></div><p class="review-text">Subimos reseñas sin pedirlo. El panel de negativas nos ha ayudado a mejorar procesos.</p></article>
            <article class="review-card"><div class="review-header"><div class="review-avatar"><img loading="lazy" src="https://i.pravatar.cc/110?img=5" alt="Eco Abraham" width="54" height="54"></div><div><div class="review-name">Eco Abraham</div><div class="review-stars">★★★★★</div></div></div><p class="review-text">Nunca había conseguido tantas reseñas reales tan rápido. El flujo NFC es comodísimo.</p></article>
          </div>
        </div>
      </div>
    </section>

    <section id="como-funciona">
      <div class="container"><h2>¿Cómo funciona Taply?</h2></div>
      <div class="container grid-3">
        <div class="card"><h3>1) Acerca el móvil</h3><p>Coloca los dispositivos <strong>Taply</strong> en tus mesas. Al acercar el smartphone aparece la pantalla de valoración.</p></div>
        <div class="card"><h3>2) Enrutado inteligente</h3><p>Si la experiencia es positiva, va a Google a dejar reseña. Si es negativa, se abre un formulario privado.</p></div>
        <div class="card"><h3>3) Formulario privado</h3><p>Adaptado a tu negocio (tiempos, atención, calidad…). Lo conectamos a una hoja privada donde se guardan todas las respuestas.</p></div>
        <div class="card"><h3>4) Aprende y mejora</h3><p>Consulta la hoja cuando quieras: gráficos, filtros por fecha y patrones para mejorar sin afectar tu puntuación pública.</p></div>
        <div class="card"><h3>5) Todo suma</h3><p>Mejores valoraciones elevan tu visibilidad en el buscador, aumentan la confianza y traen más clientes.</p></div>
      </div>
    </section>

    <section id="faq">
      <div class="container faq">
        <h2>Preguntas frecuentes</h2>
        <div class="acc" role="tablist">
          <div class="acc-item"><button class="acc-btn" aria-expanded="false">¿En qué me ayuda Taply? <span>+</span></button><div class="acc-panel"><div>Consigue <strong>mejores reseñas</strong> con un flujo sin fricción y <strong>escucha</strong> al cliente: las positivas se publican; las negativas se quedan en privado para actuar.</div></div></div>
          <div class="acc-item"><button class="acc-btn" aria-expanded="false">¿Necesito algo especial? <span>+</span></button><div class="acc-panel"><div>Solo nuestro dispositivo NFC. Funciona con la mayoría de smartphones. También te mandamos un QR.</div></div></div>
          <div class="acc-item"><button class="acc-btn" aria-expanded="false">¿Puedo ver y filtrar negativas? <span>+</span></button><div class="acc-panel"><div>Sí: en tu panel podrás ver todas, filtrarlas y detectar <strong>puntos de mejora</strong>.</div></div></div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container" style="padding:40px 0;color:#b7c3d2;border-top:1px solid rgba(255,255,255,.06)">
      <div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:20px">
        <div>
          <div class="brand" style="margin-bottom:10px"><span class="brand-logo" aria-hidden="true"></span><span>taply</span></div>
          <p style="color:#9fb0c8;max-width:560px">Tecnología NFC para convertir feedback en crecimiento real.</p>
        </div>
        <div>
          <p><a href="#beneficios">Beneficios</a></p>
          <p><a href="suscripciones.html">Suscripciones</a></p>
          <p><a href="gestionar.html" class="acct-guard">Gestionar suscripción</a></p>
        </div>
        <div>
          <p><a href="#como-funciona">Cómo funciona</a></p>
          <p><a href="suscripciones.html">Comenzar ahora</a></p>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookiebar" id="cookiebar" role="dialog" aria-live="polite" aria-label="Aviso de cookies">
    <p>Usamos cookies para ver cómo interactúas con la web. Al aceptarlas, estás de acuerdo con nuestro uso de cookies. <a href="#" style="color:#b3e1ff;text-decoration:underline">Política de privacidad</a></p>
    <button class="btn-accept" id="cookieAccept">Aceptar</button>
  </div>

  <!-- MODAL CUENTA (mismo diseño que en suscripciones) -->
  <div id="acct-modal" class="acct-hidden" role="dialog" aria-modal="true" aria-labelledby="acct-title">
    <div class="acct-dialog">
      <div class="acct-head">
        <h3 id="acct-title" style="margin:0">Accede a tu cuenta</h3>
        <button id="acct-close" class="acct-x" aria-label="Cerrar">×</button>
      </div>
      <p id="acct-msg" class="acct-msg"></p>

      <div class="acct-tabs">
        <button class="acct-tab acct-tab-active" data-tab="login">Iniciar sesión</button>
        <button class="acct-tab" data-tab="register">Registrarse</button>
        <button class="acct-tab" data-tab="forgot">Recuperar</button>
      </div>

      <!-- LOGIN -->
      <form id="acct-form-login" class="acct-form" autocomplete="on">
        <label>Email
          <span class="acct-input">
            <input id="acct-login-email" type="email" required autocomplete="email" inputmode="email" placeholder="tucorreo@ejemplo.com">
          </span>
        </label>
        <label>Contraseña
          <span class="acct-input">
            <input id="acct-login-pass" type="password" required autocomplete="current-password" placeholder="••••••••">
            <button type="button" class="toggle-eye" data-toggle="#acct-login-pass">👁</button>
          </span>
        </label>
        <button type="submit" class="btn">Entrar</button>
        <p class="acct-small">¿Has olvidado la contraseña? Abre la pestaña <strong>Recuperar</strong>.</p>
        <p id="acct-error-login" class="acct-err" style="display:none"></p>
      </form>

      <!-- REGISTER -->
      <form id="acct-form-register" class="acct-form acct-hidden" autocomplete="on" novalidate>
        <label>Nombre <input id="acct-reg-name" type="text" required autocomplete="name" minlength="2" maxlength="60" placeholder="Nombre y apellidos"></label>
        <label>Email <input id="acct-reg-email" type="email" required autocomplete="email" inputmode="email" placeholder="tucorreo@ejemplo.com"></label>
        <label>Contraseña (mín. 6)
          <span class="acct-input">
            <input id="acct-reg-pass" type="password" required minlength="6" autocomplete="new-password" placeholder="Mínimo 6 caracteres">
            <button type="button" class="toggle-eye" data-toggle="#acct-reg-pass">👁</button>
          </span>
        </label>
        <div class="pw-meter" aria-hidden="true"><span id="pwBar"></span></div>
        <label>Confirmar contraseña
          <span class="acct-input">
            <input id="acct-reg-pass2" type="password" required minlength="6" autocomplete="new-password" placeholder="Repite la contraseña">
            <button type="button" class="toggle-eye" data-toggle="#acct-reg-pass2">👁</button>
          </span>
        </label>
        <button type="submit" class="btn">Crear cuenta</button>
        <p id="acct-error-register" class="acct-err" style="display:none"></p>
      </form>

      <!-- FORGOT -->
      <form id="acct-form-forgot" class="acct-form acct-hidden" autocomplete="on">
        <label>Email <input id="acct-forgot-email" type="email" required autocomplete="email" inputmode="email" placeholder="tucorreo@ejemplo.com"></label>
        <button type="submit" class="btn">Enviar instrucciones</button>
        <p class="acct-small">Si el correo existe, recibirás un email para restablecer la contraseña.</p>
        <p id="acct-error-forgot" class="acct-err" style="display:none"></p>
      </form>
    </div>
  </div>

  <script>
    window.addEventListener('load', () => document.body.classList.add('is-loaded'));

    // Menú móvil
    const menuBtn=document.getElementById('menuBtn');
    const mobileMenu=document.getElementById('mobileMenu');
    menuBtn?.addEventListener('click', ()=> {
      const open = mobileMenu.style.display === 'block';
      mobileMenu.style.display = open ? 'none' : 'block';
      menuBtn.setAttribute('aria-expanded', String(!open));
    });
    mobileMenu?.addEventListener('click', (e)=>{ const a = e.target.closest('a'); if(a){ mobileMenu.style.display='none'; menuBtn.setAttribute('aria-expanded','false'); } });
    window.addEventListener('resize', ()=>{ if(window.innerWidth > 768){ mobileMenu.style.display='none'; menuBtn.setAttribute('aria-expanded','false'); } });

    // FAQ acordeón
    document.querySelectorAll('.acc-btn').forEach(btn=>{
      btn.setAttribute('aria-expanded','false');
      const panel=btn.nextElementSibling; if(panel) panel.style.maxHeight='0px';
      btn.addEventListener('click',()=>{
        const open=btn.getAttribute('aria-expanded')==='true';
        document.querySelectorAll('.acc-btn').forEach(b=>{ b.setAttribute('aria-expanded','false'); const p=b.nextElementSibling; if(p) p.style.maxHeight='0px'; });
        if(!open){btn.setAttribute('aria-expanded','true'); if(panel) panel.style.maxHeight=panel.scrollHeight+'px';}
      });
    });

    // Cookies
    (function(){
      const KEY='taply_cookie_consent';
      const bar=document.getElementById('cookiebar');
      const btn=document.getElementById('cookieAccept');
      if(localStorage.getItem(KEY)==='1'){ bar.style.display='none'; }
      btn.addEventListener('click',()=>{ localStorage.setItem(KEY,'1'); bar.style.display='none'; });
    })();

    /* ======= Cuenta: sesión + modal ======= */
    (function(){
      const S = { user:null };
      const $ = s => document.querySelector(s);
      const $$ = s => Array.from(document.querySelectorAll(s));
      const modal = $('#acct-modal');
      const tabs = $$('#acct-modal .acct-tab');
      const formLogin   = $('#acct-form-login');
      const formReg     = $('#acct-form-register');
      const formForgot  = $('#acct-form-forgot');
      const errLogin   = $('#acct-error-login');
      const errReg     = $('#acct-error-register');
      const errForgot  = $('#acct-error-forgot');
      const regName = $('#acct-reg-name');
      const regEmail= $('#acct-reg-email');
      const regPass = $('#acct-reg-pass');
      const regPass2= $('#acct-reg-pass2');
      const pwBar   = $('#pwBar');

      function showModal(message){
        $('#acct-msg').textContent = message || 'Inicia sesión para continuar';
        modal.classList.remove('acct-hidden'); setTab('login'); setTimeout(()=>$('#acct-login-email')?.focus(),50);
      }
      function hideModal(){ modal.classList.add('acct-hidden'); [errLogin,errReg,errForgot].forEach(e=>e&&(e.style.display='none')); }
      function setTab(name){
        formLogin.classList.toggle('acct-hidden', name!=='login');
        formReg.classList.toggle('acct-hidden',   name!=='register');
        formForgot.classList.toggle('acct-hidden',name!=='forgot');
        tabs.forEach(b=>b.classList.toggle('acct-tab-active', b.dataset.tab===name));
      }
      $('#acct-close')?.addEventListener('click', hideModal);
      modal?.addEventListener('click', e=>{ if(e.target===modal) hideModal(); });
      tabs.forEach(b=>b.addEventListener('click', ()=> setTab(b.dataset.tab)));

      async function api(method, url, body){
        const res = await fetch(url, { method, headers:{'Content-Type':'application/json'}, body: body?JSON.stringify(body):undefined });
        let data=null; try{ data = await res.json(); }catch{}
        if(!res.ok) throw (data?.error || `HTTP ${res.status}`); return data;
      }
      async function getSession(){ try{ const d=await api('GET','/api/session'); setUser(d?.user||null); }catch{ setUser(null); } }
      function setUser(u){ S.user=u; try{ localStorage.setItem('acct_user', u ? JSON.stringify(u) : ''); }catch{} paintAccountNav(); }
      function initials(str){ const n=(str||'').trim().split(/\s+/).slice(0,2).map(s=>s[0]?.toUpperCase()||'').join(''); return n||'T'; }
      function displayName(u){ return (u?.name || u?.email || 'Mi cuenta').split('@')[0]; }

      function paintAccountNav(){
        const slots = ['#acct-nav-slot','#acct-nav-slot-mobile'].map(s=>document.querySelector(s)).filter(Boolean);
        slots.forEach(slot=>{
          if(!S.user){
            slot.classList.remove('open');
            slot.innerHTML = `<button id="acct-open-nav" class="ghost">Iniciar sesión</button>`;
            slot.querySelector('#acct-open-nav')?.addEventListener('click', ()=> showModal());
            return;
          }
          slot.innerHTML = `
            <div class="acct-chip" id="acct-chip" role="button" aria-haspopup="true" aria-expanded="false">
              <span class="acct-avatar">${initials(S.user.name||S.user.email)}</span>
              <strong>${displayName(S.user)}</strong>
            </div>
            <div class="acct-menu" role="menu">
              <a href="gestionar.html" role="menuitem" class="acct-guard">Gestionar suscripción</a>
              <button id="acct-logout-btn" role="menuitem">Cerrar sesión</button>
            </div>`;
          const dd=slot, chip=dd.querySelector('#acct-chip');
          chip?.addEventListener('click', ()=>{ dd.classList.toggle('open'); chip.setAttribute('aria-expanded', dd.classList.contains('open')?'true':'false'); });
          document.addEventListener('click', (e)=>{ if(!dd.contains(e.target)) dd.classList.remove('open'); });
          dd.querySelector('#acct-logout-btn')?.addEventListener('click', async ()=>{ try{ await api('POST','/api/logout',{});}catch{} setUser(null); alert('Sesión cerrada'); });
        });
      }

      function passwordScore(p){ let s=0; if(!p) return 0; if(p.length>=6) s+=25; if(/[A-Z]/.test(p)) s+=20; if(/[a-z]/.test(p)) s+=20; if(/\d/.test(p)) s+=20; if(/[^\w\s]/.test(p)) s+=15; return Math.min(100,s); }
      regPass?.addEventListener('input', ()=>{ const v=passwordScore(regPass.value); pwBar.style.width=v+'%'; });

      formReg?.addEventListener('submit', async (e)=>{
        e.preventDefault(); errReg.style.display='none';
        if(!regName.value.trim() || regName.value.trim().length<2){ errReg.textContent='El nombre es obligatorio (mín. 2 caracteres).'; return void(errReg.style.display='block'); }
        if(regPass.value.length<6){ errReg.textContent='La contraseña debe tener al menos 6 caracteres.'; return void(errReg.style.display='block'); }
        if(regPass.value !== regPass2.value){ errReg.textContent='Las contraseñas no coinciden.'; return void(errReg.style.display='block'); }
        try{ const data = await api('POST','/api/register',{ name: regName.value.trim(), email: regEmail.value.trim(), password: regPass.value }); setUser(data?.user||null); hideModal(); }
        catch(err){ errReg.textContent = (err==='email_in_use') ? 'Ese correo ya tiene cuenta. Inicia sesión.' : String(err); errReg.style.display='block'; }
      });

      formLogin?.addEventListener('submit', async (e)=>{
        e.preventDefault(); errLogin.style.display='none';
        const email = $('#acct-login-email').value.trim(); const password = $('#acct-login-pass').value;
        try{ const data = await api('POST','/api/login',{ email, password }); setUser(data?.user||null); hideModal(); }
        catch(err){
          errLogin.textContent = (err==='account_not_found') ? 'No existe una cuenta con ese email.' :
                                 (err==='invalid_credentials') ? 'Contraseña incorrecta.' :
                                 (err==='password_not_set') ? 'Esta cuenta no tiene contraseña. Usa “Recuperar”.' : String(err);
          errLogin.style.display='block';
        }
      });

      formForgot?.addEventListener('submit', async (e)=>{
        e.preventDefault(); errForgot.style.display='none';
        const email = $('#acct-forgot-email').value.trim();
        try{ await api('POST','/api/request-password-reset',{ email }); hideModal(); alert('Si el correo existe, te hemos enviado un email con instrucciones.'); }
        catch(_){ hideModal(); alert('Si el correo existe, te hemos enviado un email con instrucciones.'); }
      });

      // Gating “gestionar” sin sesión
      document.body.addEventListener('click',(e)=>{ const a=e.target.closest('a.acct-guard'); if(a && !S.user){ e.preventDefault(); showModal('Inicia sesión para gestionar tu suscripción.'); } });

      getSession();
      window.TaplyOpenLogin = showModal;
    })();
  </script>
</body>
</html>

